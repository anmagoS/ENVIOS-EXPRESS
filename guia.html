<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a de Env√≠o - Expres Contraentrega</title>
    <!-- QR Code library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- C√≥digo de barras library -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <!-- Nuestros estilos -->
    <link rel="stylesheet" href="guia.css">
    <style>
    /* Estilos para visualizaci√≥n en pantalla */
    @media screen {
        body {
            background: #f0f0f0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .guia-container {
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 2px dashed #ccc;
            height: auto; /* Cambiado a auto para ajustarse al contenido */
            min-height: 145mm; /* Reducido porque eliminamos secciones */
        }
        
        .no-print {
            display: block;
        }
        
        .print-instructions {
            font-size: 12px;
            color: #666;
        }
        
        .print-instructions p:first-child {
            color: #135bec;
            font-weight: bold;
        }
    }
    
    /* Para impresi√≥n - tama√±o 8x15 cm */
    @media print {
        @page {
            size: 79mm 149mm;
            margin: 2mm;
        }
    }
    
    /* Nuevos estilos para secci√≥n de observaciones ampliada */
    .seccion.observaciones {
        background-color: #f9f9f9;
        border: 1px dashed #ccc;
        padding: 5px;
        margin-top: 5px;
    }
    
    .observaciones-content {
        min-height: 30px;
        padding: 3px;
        font-size: 9px;
        line-height: 1.2;
        word-break: break-word;
        white-space: pre-wrap;
    }
    
    /* Ajustar altura del contenedor */
    .guia-container {
        height: 155mm;
        position: relative;
    }
</style>
<!-- EN EL HEAD DE guia.html -->
<script>
    // VERIFICACI√ìN DE AUTENTICACI√ìN
    (function() {
        const usuario = JSON.parse(localStorage.getItem("usuarioLogueado"));
        
        if (!usuario) {
            console.log("‚ùå No autorizado para ver gu√≠as");
            window.location.replace("login.html");
            return;
        }
        
        console.log("‚úÖ Usuario autorizado para gu√≠as:", usuario.USUARIO);
    })();
</script>
</head>
<body>
    <!-- Controles solo para pantalla -->
    <div class="no-print screen-controls">
        <button onclick="window.print()" class="btn-print">üñ®Ô∏è Imprimir Gu√≠a</button>
        <button onclick="window.close()" class="btn-close">‚úñÔ∏è Cerrar</button>
        <div class="print-instructions">
            <p><strong>Configuraci√≥n de impresi√≥n:</strong> Tama√±o 8x15 cm, sin m√°rgenes</p>
            <p>Las secciones de Zona y Mensajero han sido eliminadas. El campo OBS est√° en blanco para anotaciones manuales.</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL DE LA GU√çA -->
    <div class="guia-container">
        
        <!-- ENCABEZADO -->
        <header class="guia-header">
            <div class="logo-section">
                <div class="logo">üöö</div>
                <div class="empresa-info">
                    <h1>EXPRES CONTRAENTREGA</h1>
                    <p class="slogan">Tu env√≠o r√°pido y seguro</p>
                </div>
            </div>
            
            <div class="guia-info">
                <div class="info-row">
                    <span class="label">GU√çA No:</span>
                    <span class="value guia-id" id="guiaId">Cargando...</span>
                </div>
                <div class="info-row">
                    <span class="label">FECHA:</span>
                    <span class="value" id="fecha">Cargando...</span>
                </div>
                <div class="info-row">
                    <span class="label">FORMA DE PAGO:</span>
                    <span class="value forma-pago" id="formaPago">Cargando...</span>
                </div>
            </div>
        </header>

        <!-- L√çNEA DIVISORIA -->
        <div class="divider"></div>

        <!-- C√ìDIGO DE BARRAS -->
        <div class="codigo-barras-section">
            <svg id="codigoBarras" class="codigo-barras"></svg>
            <div class="numero-guia-barras" id="numeroGuiaBarras">Cargando...</div>
        </div>

        <!-- L√çNEA DIVISORIA -->
        <div class="divider thin"></div>

        <!-- SECCI√ìN REMITENTE -->
        <section class="seccion remitente">
            <h2 class="seccion-title">üìç REMITENTE</h2>
            <div class="datos">
                <div class="dato-line">
                    <strong id="remitenteNombre">Cargando...</strong>
                </div>
                <div class="dato-line">
                    <span class="label">Tel:</span>
                    <span id="remitenteTelefono">Cargando...</span>
                </div>
                <div class="dato-line">
                    <span class="label">Ciudad:</span>
                    <span id="remitenteCiudad">Cargando...</span>
                </div>
            </div>
        </section>

        <!-- L√çNEA DIVISORIA -->
        <div class="divider"></div>

        <!-- SECCI√ìN DESTINATARIO -->
        <section class="seccion destinatario">
            <h2 class="seccion-title">üë§ DESTINATARIO</h2>
            <div class="datos">
                <div class="dato-line">
                    <strong id="destinatarioNombre">Cargando...</strong>
                </div>
                <div class="dato-line">
                    <span class="label">Tel:</span>
                    <span id="destinatarioTelefono">Cargando...</span>
                </div>
                <div class="dato-line">
                    <span id="destinatarioDireccion">Cargando...</span>
                </div>
                <div class="dato-line">
                    <span id="destinatarioBarrio">Cargando...</span>
                </div>
                <div class="dato-line">
                    <span class="label">Ciudad:</span>
                    <span id="destinatarioCiudad">Cargando...</span>
                </div>
                <div class="dato-line complemento">
                    <span class="label">Complemento:</span>
                    <span id="complemento">Cargando...</span>
                </div>
            </div>
        </section>

        <!-- L√çNEA DIVISORIA -->
        <div class="divider"></div>

        <!-- SECCI√ìN INFORMACI√ìN DE PAGO -->
        <section class="seccion pago">
            <h2 class="seccion-title">üí∞ INFORMACI√ìN DE PAGO</h2>
            <div class="datos-pago">
                <div class="pago-row">
                    <span class="label">Valor a Recaudar:</span>
                    <span class="value valor" id="valorRecaudar">Cargando...</span>
                </div>
            </div>
        </section>

        <!-- L√çNEA DIVISORIA -->
        <div class="divider"></div>

        <!-- SECCI√ìN OBSERVACIONES (REEMPLAZA LOG√çSTICA) -->
        <section class="seccion observaciones">
            <h2 class="seccion-title">üìù OBSERVACIONES</h2>
            <div class="observaciones-content" id="observaciones">
                <!-- Campo en blanco para anotaciones manuales -->
                <div style="height: 25px; border-bottom: 1px dotted #ccc;"></div>
                <div style="height: 25px; border-bottom: 1px dotted #ccc;"></div>
                <div style="height: 25px; border-bottom: 1px dotted #ccc;"></div>
            </div>
        </section>

        <!-- PIE DE P√ÅGINA -->
        <footer class="guia-footer">
            <div class="footer-line">
                <span class="small">üìû Soporte: 3001234567</span>
                <span class="small">üåê www.exprescontraentrega.com</span>
            </div>
            <div class="footer-line">
                <span class="small">Gu√≠a generada el: <span id="fechaGeneracion">Cargando...</span></span>
            </div>
        </footer>
    </div>

    <!-- Nuestro JavaScript -->
    <script src="guia.js"></script>
    <script>
        // Modificamos el guia.js para que no cargue zona y mensajero
        document.addEventListener('DOMContentLoaded', function() {
            // Tu c√≥digo existente para cargar datos...
            
            // Obtener ID de la gu√≠a de la URL
            const urlParams = new URLSearchParams(window.location.search);
            const guiaId = urlParams.get('id');
            
            if (guiaId) {
                cargarGuia(guiaId);
            } else {
                console.error('No se proporcion√≥ ID de gu√≠a');
                document.getElementById('guiaId').textContent = 'ERROR: Sin ID';
            }
        });

        function cargarGuia(guiaId) {
            // Simulaci√≥n de carga de datos
            // En tu c√≥digo real, esto vendr√≠a de una API
            
            // Ejemplo de datos
            const datosGuia = {
                id: guiaId,
                fecha: new Date().toLocaleDateString('es-ES'),
                formaPago: "CONTRAENTREGA",
                remitente: {
                    nombre: "ALMACEN EL BUEN PRECIO",
                    telefono: "3101234567",
                    ciudad: "BOGOT√Å D.C."
                },
                destinatario: {
                    nombre: "MAR√çA GARC√çA",
                    telefono: "3209876543",
                    direccion: "CRA 45 # 26-85",
                    barrio: "CHAPINERO",
                    ciudad: "BOGOT√Å D.C.",
                    complemento: "APT 302 - PORTER√çA"
                },
                pago: {
                    valorRecaudar: "$150.000"
                }
                // Nota: No incluimos zona ni mensajero
            };

            // Llenar los datos en la gu√≠a
            document.getElementById('guiaId').textContent = datosGuia.id;
            document.getElementById('numeroGuiaBarras').textContent = datosGuia.id;
            document.getElementById('fecha').textContent = datosGuia.fecha;
            document.getElementById('formaPago').textContent = datosGuia.formaPago;
            
            // Remitente
            document.getElementById('remitenteNombre').textContent = datosGuia.remitente.nombre;
            document.getElementById('remitenteTelefono').textContent = datosGuia.remitente.telefono;
            document.getElementById('remitenteCiudad').textContent = datosGuia.remitente.ciudad;
            
            // Destinatario
            document.getElementById('destinatarioNombre').textContent = datosGuia.destinatario.nombre;
            document.getElementById('destinatarioTelefono').textContent = datosGuia.destinatario.telefono;
            document.getElementById('destinatarioDireccion').textContent = datosGuia.destinatario.direccion;
            document.getElementById('destinatarioBarrio').textContent = datosGuia.destinatario.barrio;
            document.getElementById('destinatarioCiudad').textContent = datosGuia.destinatario.ciudad;
            document.getElementById('complemento').textContent = datosGuia.destinatario.complemento;
            
            // Pago
            document.getElementById('valorRecaudar').textContent = datosGuia.pago.valorRecaudar;
            
            // Fecha de generaci√≥n
            document.getElementById('fechaGeneracion').textContent = new Date().toLocaleString('es-ES');
            
            // Generar c√≥digo de barras
            if (typeof JsBarcode !== 'undefined') {
                JsBarcode("#codigoBarras", datosGuia.id, {
                    format: "CODE128",
                    width: 1.5,
                    height: 40,
                    displayValue: false
                });
            }
            
            console.log("‚úÖ Gu√≠a cargada sin zona/mensajero. Campo OBS en blanco para anotaciones manuales.");
        }
    </script>
    
    <!-- Si a√∫n necesitas check-auth.js, aseg√∫rate de que exista -->
    <!-- <script src="check-auth.js"></script> -->
</body>
</html>
